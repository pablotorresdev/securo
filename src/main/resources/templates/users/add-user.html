<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CU33 - Agregar Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Agregar Nuevo Usuario</h2>

    <!-- Mensajes de error -->
    <div class="alert alert-danger" role="alert" th:if="${error}">
        <span th:text="${error}"></span>
    </div>

    <form method="post" th:action="@{/users/add-user}" th:object="${user}" class="needs-validation">
        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">

        <div class="mb-3">
            <label for="username" class="form-label">Nombre de usuario</label>
            <input type="text"
                   class="form-control"
                   id="username"
                   name="username"
                   th:field="*{username}"
                   minlength="3"
                   maxlength="50"
                   required
                   placeholder="Ingrese el nombre de usuario">
            <div class="form-text">Mínimo 3 caracteres, máximo 50</div>
        </div>

        <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password"
                   class="form-control"
                   id="password"
                   name="password"
                   th:field="*{password}"
                   minlength="3"
                   required
                   placeholder="Ingrese la contraseña">
            <div class="form-text">Mínimo 3 caracteres</div>
        </div>

        <div class="mb-3">
            <label for="role" class="form-label">Rol</label>
            <select class="form-select" id="role" th:field="*{role.id}" required>
                <option value="" disabled selected>Seleccione un rol</option>
                <option th:each="role : ${roles}"
                        th:value="${role.id}"
                        th:text="${role.name + ' (Nivel ' + role.nivel + ')'}">
                </option>
            </select>
            <div class="form-text">Seleccione el rol que tendrá el usuario</div>
        </div>

        <div class="mb-3">
            <label for="fechaExpiracion" class="form-label">Fecha de Expiración (Opcional)</label>
            <input type="date"
                   class="form-control"
                   id="fechaExpiracion"
                   name="fechaExpiracion"
                   th:field="*{fechaExpiracion}"
                   placeholder="yyyy-MM-dd">
            <div class="form-text">Dejar vacío para usuarios permanentes. Usar para usuarios temporales como AUDITOR</div>
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-primary">Guardar Usuario</button>
            <a th:href="@{/users/list-users}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
